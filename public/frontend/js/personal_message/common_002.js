define(function(require){var a=require("./avatorTpl.js");$(".js-avator-link").on("click",function(){$.dialog(a,{title:"更换头像",modal:!0})}),$(".js-tip-close").on("click",function(){$(".oplog-tip").fadeOut()}),$(".avator-mode").on("mouseover",function(){$(".update-avator").css("bottom","0")}).on("mouseout",function(){$(".update-avator").css("bottom","-30px")}),$(".js-auth-list dd").hover(function(){$(this).find(".icon-tips").fadeIn("fast")},function(){$(this).find(".icon-tips").fadeOut("fast")}),$(document).on("click",".avator-btn-fake",function(){$("#upload").click()}).on("click",".js-avator-save",function(){var a=$("#js-portrait").data("portrait");$.ajax({url:"/user/ajaxsetportrait",type:"post",data:{portrait:a},dataType:"json",success:function(a){1==a.result?location.reload():$.alert(a.msg)}})});var c=function(){var m={};return{set:function(t,a){m.xhr&&m.xhr.abort(),m.type=t,a&&(m.xhr=a)},is:function(t){return m.type===t},get:function(){return m.type}}}(),g=function(a){var c;c=$(".tpl-avator .avator-img"),c.attr("data-portrait",a.imgname),c.attr("src",a.imgpath)};$(document).on("logined.sns",function(e){$("#avator-btns").find('[data-sns="'+c.get()+'"]').trigger("click").siblings(".avator-sns-relogintip").remove(),e.preventDefault()}),$(document).on("click","[data-sns]",function(){var a=$(this),v=a.attr("data-sns");c.set(v),$.ajax({url:"/user/getimage?type="+v+"_sid",dataType:"json",success:function(a){c.is(v)&&(1==a.result?g(a.data):$.alert("error",{info:a.msg}))},error:function(){$.alert("error",{info:"后端请求失败,请稍后重试！"})}})}),$(document).on("click",".js-avator-try",function(){c.set("try"),$.getJSON("/user/randimage/","type=1",function(a){c.is("try")&&a&&g(a)})}),!function(){$(document).on("change","#upload",function(){this.value&&(c.set("local"),this.form.submit())}),$("#uploadtarget").on("load",function(){if(c.is("local")){var a=$("#uploadtarget").contents().find("body").text();if(a=$.parseJSON(a),null==a.data)return void $("#js-portrait").siblings(".rlf-tip-wrap").append(a.msg);$("#js-portrait").siblings(".rlf-tip-wrap").empty();var v={};v.imgname=a.data.key,v.imgpath=a.data.imgpath,g(v)}})}()});